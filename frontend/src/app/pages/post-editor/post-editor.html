<div class="form-container">
  <mat-card class="post-editor-card">
    <mat-card-content *ngIf="!isEditMode || (isEditMode && post)">
      <form #postForm="ngForm" (ngSubmit)="onSubmit(postForm)">
        <input
          type="file"
          id="editor-media-input"
          (change)="handleEditorMediaUpload($event)"
          accept="image/*,video/*"
          hidden
        />
        
        <mat-form-field appearance="outline" class="title-field">
          <mat-label>New post title here...</mat-label>
          <input 
            matInput 
            name="title" 
            [ngModel]="post?.title" 
            required 
            maxlength="150" 
            #titleInput="ngModel">
           <mat-error *ngIf="titleInput.touched && titleInput.errors?.['required']">Title is required.</mat-error>
           <mat-error *ngIf="titleInput.touched && titleInput.errors?.['maxlength']">Title cannot exceed 150 characters.</mat-error>
        </mat-form-field>
        
        <mat-form-field appearance="outline" class="tags-field">
          <mat-label>Add up to 4 tags (comma-separated)</mat-label>
          <input 
            matInput 
            name="tags" 
            [(ngModel)]="tagsString"
            #tagsInput="ngModel">
        </mat-form-field>

        <div class="quill-editor-container">
          <quill-editor
            #editor
            [(ngModel)]="editorContent"
            name="editorContent"
            [modules]="quillModules"
            (onEditorCreated)="editorCreated($event)"
            placeholder="Write your post content here..."
            [required]="true"
            [maxLength]="10000"
            #editorInput="ngModel">
          </quill-editor>
          <mat-error *ngIf="postForm.submitted && !editorContent?.trim()">Content cannot be empty.</mat-error>
          <mat-error *ngIf="editorInput.touched && editorInput.errors?.['maxlength']">Content cannot exceed 10000 characters.</mat-error>
        </div>
        
        <div *ngIf="errorMessage" class="error-message">
           {{ errorMessage }}
         </div>

        <div class="form-actions">
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="postForm.invalid || !editorContent?.trim() || isSubmitting"
            class="publish-button">
            <span *ngIf="isSubmitting">Saving...</span>
            <span *ngIf="!isSubmitting">{{ isEditMode ? "Save Changes" : "Publish" }}</span>
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>
</div>