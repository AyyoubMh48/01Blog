<div
  class="feed-page-layout"
  infiniteScroll
  [infiniteScrollContainer]="'.main-feed-column'" 
  [fromRoot]="true" 
  [infiniteScrollDistance]="2"
  [infiniteScrollThrottle]="300"
  (scrolled)="onScroll()">
  
  <!-- Enhanced Sidebar with Glassmorphism -->
  <aside class="sidebar-column">
    <!-- Trending Posts Card -->
    <mat-card class="sidebar-card trending-card" *ngIf="trendingPosts.length > 0">
      <mat-card-header>
        <mat-card-title>
          <span class="emoji-icon">üî•</span>
          <span class="title-text">Trending Now</span>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <ul class="trending-list">
          <li *ngFor="let trendPost of trendingPosts; let i = index" class="trending-item" [style.animation-delay.ms]="i * 50">
            <a [routerLink]="['/post', trendPost.id]" class="trending-link">
              <span class="trending-title">{{ trendPost.title }}</span>
              <div class="post-tags" *ngIf="trendPost.tags.length > 0">
                <a *ngFor="let tag of trendPost.tags.slice(0, 3)" 
                   [routerLink]="['/tag', tag.name]" 
                   class="tag-link tag-link-small"
                   (click)="$event.stopPropagation()">
                  #{{ tag.name }}
                </a>
              </div>
            </a>
          </li>
        </ul>
      </mat-card-content>
    </mat-card>

    <!-- Popular Tags Card -->
    <mat-card class="sidebar-card tags-card" *ngIf="popularTags.length > 0">
      <mat-card-header>
        <mat-card-title>
          <span class="emoji-icon">üè∑Ô∏è</span>
          <span class="title-text">Popular Topics</span>
        </mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="tag-cloud">
          <a *ngFor="let tag of popularTags; let i = index" 
             [routerLink]="['/tag', tag.name]" 
             class="tag-link tag-bubble"
             [style.animation-delay.ms]="i * 30">
            #{{ tag.name }}
          </a>
        </div>
      </mat-card-content>
    </mat-card>
  </aside>

  <!-- Main Feed Column -->
  <div class="main-feed-column">
    <!-- Enhanced Filter Tabs -->
    <div *ngIf="isLoggedIn" class="feed-filters">
      <div class="filter-tabs">
        <button mat-button
          class="filter-tab"
          [class.active-filter]="activeFilter === 'following'"
          (click)="setFilter('following')">
          <mat-icon class="filter-icon">people</mat-icon>
          <span>Following</span>
        </button>
        <button mat-button
          class="filter-tab"
          [class.active-filter]="activeFilter === 'myPosts'"
          (click)="setFilter('myPosts')">
          <mat-icon class="filter-icon">article</mat-icon>
          <span>My Posts</span>
        </button>
        <button mat-button
          class="filter-tab"
          [class.active-filter]="activeFilter === 'all'"
          (click)="setFilter('all')">
          <mat-icon class="filter-icon">explore</mat-icon>
          <span>Explore</span>
        </button>
      </div>
      <div class="filter-indicator" [attr.data-filter]="activeFilter"></div>
    </div>

    <!-- Enhanced Login Prompt -->
    <div *ngIf="!isLoggedIn" class="login-prompt">
      <mat-card class="welcome-card">
        <mat-card-content>
          <div class="welcome-content">
            <div class="welcome-icon">‚ú®</div>
            <h3 class="welcome-title">Welcome to 01Blog!</h3>
            <p class="welcome-subtitle">Join our community to create posts and personalize your feed</p>
            <a mat-raised-button color="primary" routerLink="/login" class="login-btn">
              <mat-icon>login</mat-icon>
              <span>Get Started</span>
            </a>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Post List with Stagger Animation -->
    <div class="post-list">
      <div *ngIf="posts.length === 0 && !isLoading" class="no-posts-message">
        <div class="empty-state">
          <mat-icon class="empty-icon">inbox</mat-icon>
          <p class="empty-text">No posts yet in this feed</p>
          <p class="empty-subtext">Check back later or explore other topics</p>
        </div>
      </div>

      <!-- Enhanced Post Cards -->
      <a *ngFor="let post of posts; let i = index" 
         [routerLink]="['/post', post.id]" 
         class="post-card-link"
         [style.animation-delay.ms]="i * 60">
        <mat-card class="post-card devto-style">
          <!-- Media Section -->
          <div class="post-media-wrapper" *ngIf="post.mediaUrl && !post.mediaUrl.includes('/video/')">
            <img mat-card-image 
                 [src]="post.mediaUrl" 
                 alt="Post media"
                 class="post-media-image"
                 loading="lazy">
            <div class="media-overlay"></div>
          </div>

          <!-- Content Section -->
          <div class="post-card-main-content">
            <mat-card-header class="post-header">
              <div mat-card-avatar 
                   class="post-avatar" 
                   [style.backgroundImage]="'url(' + post.author.avatarUrl + ')'">
              </div>
              <div class="author-info">
                <mat-card-title class="author-name">{{ post.author.username }}</mat-card-title>
                <mat-card-subtitle class="post-date">
                  <mat-icon class="date-icon">schedule</mat-icon>
                  {{ post.createdAt | date:'MMM d, y' }}
                </mat-card-subtitle>
              </div>
            </mat-card-header>

            <mat-card-content class="post-summary">
              <h2 class="post-title">{{ post.title }}</h2>
              <div class="post-tags" *ngIf="post.tags.length > 0">
                <a *ngFor="let tag of post.tags.slice(0, 4)" 
                   [routerLink]="['/tag', tag.name]" 
                   class="tag-link tag-pill"
                   (click)="$event.stopPropagation()">
                  #{{ tag.name }}
                </a>
                <span *ngIf="post.tags.length > 4" class="tag-more">+{{ post.tags.length - 4 }}</span>
              </div>
            </mat-card-content>
          </div>

          <!-- Enhanced Stats Section -->
          <mat-card-actions class="stats">
            <div class="stat-item">
              <button mat-icon-button disabled class="stat-btn">
                <mat-icon>favorite_border</mat-icon>
              </button>
              <span class="stat-count">{{ post.likeCount | number }}</span>
            </div>
            <div class="stat-item">
              <button mat-icon-button disabled class="stat-btn">
                <mat-icon>chat_bubble_outline</mat-icon>
              </button>
              <span class="stat-count">{{ post.commentCount | number }}</span>
            </div>
            <div class="stat-spacer"></div>
            <button mat-icon-button class="share-btn" (click)="$event.preventDefault(); $event.stopPropagation()">
              <mat-icon>share</mat-icon>
            </button>
          </mat-card-actions>
        </mat-card>
      </a>
    </div>

    <!-- Enhanced Loading Indicator -->
    <div *ngIf="isLoading" class="loading-indicator">
      <div class="loading-spinner">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
      <p class="loading-text">Discovering more amazing content...</p>
    </div>
  </div>
</div>