<div class="block-container">
  <div *ngIf="!userProfile && !errorMessage">Loading profile...</div>
  <div *ngIf="errorMessage">{{ errorMessage }}</div>

  <div *ngIf="userProfile">
    <mat-card class="profile-header-card">
      <div class="profile-header">
        <h2>{{ userProfile.username }}'s Block</h2>

        <div class="profile-actions">
          <div *ngIf="isLoggedIn && !isOwnProfile" class="follow-buttons">
            <button
              *ngIf="!userProfile.followedByCurrentUser"
              mat-raised-button
              color="primary"
              (click)="follow()"
            >
              Follow
            </button>
            <button
              *ngIf="userProfile.followedByCurrentUser"
              mat-stroked-button
              (click)="unfollow()"
            >
              Unfollow
            </button>
          </div>
          <button
            *ngIf="isLoggedIn && !isOwnProfile"
            mat-button
            color="warn"
            (click)="showReportForm = !showReportForm"
          >
            Report
          </button>
        </div>
      </div>
    </mat-card>

    <mat-card *ngIf="showReportForm" class="report-form">
      <mat-card-header
        ><mat-card-title
          >Report {{ userProfile.username }}</mat-card-title
        ></mat-card-header
      >
      <mat-card-content>
        <form #reportForm="ngForm" (ngSubmit)="onReportSubmit(reportForm)">
          <mat-form-field appearance="outline">
            <mat-label>Please provide a reason...</mat-label>
            <textarea
              matInput
              name="reason"
              rows="4"
              ngModel
              required
            ></textarea>
          </mat-form-field>
          <div class="form-actions">
            <button type="button" mat-button (click)="showReportForm = false">
              Cancel
            </button>
            <button
              type="submit"
              mat-raised-button
              color="warn"
              [disabled]="reportForm.invalid"
            >
              Submit Report
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <section class="post-list">
  <h3>Posts</h3>
  <div *ngIf="userProfile.posts?.length === 0">This user hasn't posted anything yet.</div>

  <a *ngFor="let post of userProfile?.posts" [routerLink]="['/post', post.id]" class="post-card-link">
    <mat-card class="post-card">
      
      <img mat-card-image *ngIf="post.mediaUrl && !post.mediaUrl.includes('/video/')" [src]="post.mediaUrl" alt="Post media">
      
      <mat-card-header>
        <mat-card-subtitle>{{ post.createdAt | date:'MMM d' }}</mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content class="post-summary">
        <h2>{{ post.title }}</h2>
        <p>{{ stripHtml(post.content) | slice:0:150 }}...</p>
      </mat-card-content>
      
      <mat-card-actions class="stats">
        <button mat-icon-button disabled><mat-icon>favorite_border</mat-icon></button>
        <span>{{ post.likeCount }}</span>
        <button mat-icon-button disabled><mat-icon>chat_bubble_outline</mat-icon></button>
        <span>{{ post.commentCount }}</span>
      </mat-card-actions>
    </mat-card>
  </a>
</section>
  </div>
</div>
